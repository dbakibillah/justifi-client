<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arbitration Agreement Form</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        .signature-container {
            border: 1px solid #e5e7eb;
            border-radius: 0.375rem;
            background-color: white;
            min-height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            cursor: pointer;
        }
        .signature-preview {
            max-width: 100%;
            max-height: 150px;
        }
        .agreement-output {
            font-family: 'Times New Roman', Times, serif;
            line-height: 1.6;
        }
        .party-card {
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            background-color: #f9fafb;
            position: relative;
        }
        .remove-party {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
        }
        .signature-field {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px dashed #e5e7eb;
        }
        .signature-slot {
            border-bottom: 1px solid #000;
            min-height: 60px;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        @media print {
            .no-print {
                display: none !important;
            }
            .agreement-output {
                font-size: 12pt;
            }
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-center mb-8">Arbitration Agreement Form</h1>
        
        <!-- Form Section -->
        <div id="form-section" class="bg-white rounded-lg shadow-md p-6 mb-8">
            <form id="arbitration-form">
                <!-- Date Section -->
                <div class="mb-6">
                    <h2 class="text-xl font-semibold mb-4">Agreement Date</h2>
                    <div class="max-w-xs">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                        <input type="date" id="agreement-date" class="w-full border border-gray-300 rounded-md px-3 py-2" required>
                    </div>
                </div>
                
                <!-- Party Information -->
                <div class="mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold">Party Information</h2>
                        <div class="space-x-2">
                            <button type="button" id="add-plaintiff" class="bg-blue-500 text-white px-3 py-1 rounded text-sm">Add Plaintiff</button>
                            <button type="button" id="add-defendant" class="bg-green-500 text-white px-3 py-1 rounded text-sm">Add Defendant</button>
                        </div>
                    </div>
                    
                    <div id="parties-container">
                        <!-- Plaintiffs Section -->
                        <div class="mb-6">
                            <h3 class="text-lg font-medium mb-3 text-blue-600">Party 1 - Plaintiffs/Claimants</h3>
                            <div id="plaintiffs-container">
                                <!-- Plaintiff cards will be added here -->
                            </div>
                        </div>
                        
                        <!-- Defendants Section -->
                        <div class="mb-6">
                            <h3 class="text-lg font-medium mb-3 text-red-600">Party 2 - Defendants/Respondents</h3>
                            <div id="defendants-container">
                                <!-- Defendant cards will be added here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Dispute Information -->
                <div class="mb-6">
                    <h2 class="text-xl font-semibold mb-4">Dispute Information</h2>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Nature of Dispute</label>
                        <textarea id="dispute-nature" class="w-full border border-gray-300 rounded-md px-3 py-2" rows="3" required></textarea>
                    </div>
                </div>
                
                <!-- Arbitrators Information -->
                <div class="mb-6">
                    <h2 class="text-xl font-semibold mb-4">Arbitrators Information</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Arbitrator 1</label>
                            <input type="text" id="arbitrator1" class="w-full border border-gray-300 rounded-md px-3 py-2" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Arbitrator 2</label>
                            <input type="text" id="arbitrator2" class="w-full border border-gray-300 rounded-md px-3 py-2" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Presiding Arbitrator</label>
                            <input type="text" id="presiding-arbitrator" class="w-full border border-gray-300 rounded-md px-3 py-2" required>
                        </div>
                    </div>
                </div>
                
                <!-- Financial Information -->
                <div class="mb-6">
                    <h2 class="text-xl font-semibold mb-4">Financial Information</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Suit Value (BDT)</label>
                            <input type="number" id="suit-value" class="w-full border border-gray-300 rounded-md px-3 py-2" min="0" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Number of Sittings</label>
                            <input type="number" id="sittings" class="w-full border border-gray-300 rounded-md px-3 py-2" min="1" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Total Arbitration Cost (BDT)</label>
                            <input type="number" id="total-cost" class="w-full border border-gray-300 rounded-md px-3 py-2" min="0" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Award Compliance Days</label>
                            <input type="number" id="compliance-days" class="w-full border border-gray-300 rounded-md px-3 py-2" min="1" required>
                        </div>
                    </div>
                </div>
                
                <!-- JustiFi Representative -->
                <div class="mb-6">
                    <h2 class="text-xl font-semibold mb-4">JustiFi Representative</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                            <input type="text" id="justifi-name" class="w-full border border-gray-300 rounded-md px-3 py-2" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Designation</label>
                            <input type="text" id="justifi-designation" class="w-full border border-gray-300 rounded-md px-3 py-2" required>
                        </div>
                    </div>
                </div>
                
                <!-- JustiFi Representative Signature -->
                <div class="mb-6">
                    <h2 class="text-xl font-semibold mb-4">JustiFi Representative Signature</h2>
                    <div class="border border-gray-200 rounded-md p-4">
                        <div class="signature-container mb-3">
                            <input type="file" id="justifi-signature-upload" class="hidden" accept="image/*">
                            <div id="justifi-signature-preview" class="w-full h-full flex items-center justify-center">
                                <span class="text-gray-500">Click to upload signature</span>
                            </div>
                        </div>
                        <div class="flex justify-between">
                            <button type="button" id="clear-justifi-signature" class="bg-red-500 text-white px-3 py-1 rounded text-sm">Clear</button>
                            <div class="text-sm text-gray-500">Upload signature image (PNG, JPG)</div>
                        </div>
                        <div class="mt-3">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                            <input type="date" id="justifi-date" class="w-full border border-gray-300 rounded-md px-3 py-2" required>
                        </div>
                    </div>
                </div>
                
                <!-- Submit Button -->
                <div class="flex justify-center">
                    <button type="submit" class="bg-blue-600 text-white px-6 py-3 rounded-md font-medium hover:bg-blue-700 transition-colors">
                        Generate Arbitration Agreement
                    </button>
                </div>
            </form>
        </div>
        
        <!-- Output Section (Initially Hidden) -->
        <div id="output-section" class="bg-white rounded-lg shadow-md p-6 hidden">
            <div class="flex justify-between items-center mb-4 no-print">
                <h2 class="text-2xl font-bold">Generated Arbitration Agreement</h2>
                <button id="back-to-form" class="bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 transition-colors">
                    Back to Form
                </button>
            </div>
            <div id="agreement-output" class="agreement-output border border-gray-200 rounded-md p-6 bg-gray-50">
                <!-- Agreement content will be inserted here by JavaScript -->
            </div>
            <div class="mt-4 flex justify-center no-print">
                <button id="download-pdf" class="bg-green-600 text-white px-6 py-2 rounded-md font-medium hover:bg-green-700 transition-colors">
                    Download as PDF
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let plaintiffs = [];
        let defendants = [];
        let nextPlaintiffId = 1;
        let nextDefendantId = 1;
        let justifiSignature = null;

        document.addEventListener('DOMContentLoaded', function() {
            // Set default date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('agreement-date').value = today;
            document.getElementById('justifi-date').value = today;

            // Initialize with one plaintiff and one defendant
            addPlaintiff();
            addDefendant();

            // Add plaintiff button
            document.getElementById('add-plaintiff').addEventListener('click', addPlaintiff);
            
            // Add defendant button
            document.getElementById('add-defendant').addEventListener('click', addDefendant);

            // JustiFi signature upload
            const justifiSignatureContainer = document.getElementById('justifi-signature-preview');
            const justifiSignatureUpload = document.getElementById('justifi-signature-upload');
            
            justifiSignatureContainer.addEventListener('click', function() {
                justifiSignatureUpload.click();
            });
            
            justifiSignatureUpload.addEventListener('change', function(e) {
                if (e.target.files && e.target.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        justifiSignature = event.target.result;
                        justifiSignatureContainer.innerHTML = `<img src="${justifiSignature}" class="signature-preview" alt="JustiFi Signature">`;
                    };
                    reader.readAsDataURL(e.target.files[0]);
                }
            });
            
            // Clear JustiFi signature
            document.getElementById('clear-justifi-signature').addEventListener('click', function() {
                justifiSignature = null;
                justifiSignatureContainer.innerHTML = '<span class="text-gray-500">Click to upload signature</span>';
                justifiSignatureUpload.value = '';
            });

            // Form submission
            document.getElementById('arbitration-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Validate at least one plaintiff and one defendant
                if (plaintiffs.length === 0 || defendants.length === 0) {
                    alert('Please add at least one plaintiff and one defendant.');
                    return;
                }
                
                // Validate all signatures are provided
                let allSignaturesProvided = true;
                let missingSignatures = [];
                
                plaintiffs.forEach(plaintiff => {
                    if (!plaintiff.signature) {
                        allSignaturesProvided = false;
                        missingSignatures.push(`Plaintiff: ${plaintiff.name}`);
                    }
                });
                
                defendants.forEach(defendant => {
                    if (!defendant.signature) {
                        allSignaturesProvided = false;
                        missingSignatures.push(`Defendant: ${defendant.name}`);
                    }
                });
                
                if (!justifiSignature) {
                    allSignaturesProvided = false;
                    missingSignatures.push('JustiFi Representative');
                }
                
                if (!allSignaturesProvided) {
                    alert('Please provide signatures for all parties:\n' + missingSignatures.join('\n'));
                    return;
                }
                
                // Get form values
                const formData = {
                    agreementDate: document.getElementById('agreement-date').value,
                    plaintiffs: plaintiffs,
                    defendants: defendants,
                    disputeNature: document.getElementById('dispute-nature').value,
                    arbitrator1: document.getElementById('arbitrator1').value,
                    arbitrator2: document.getElementById('arbitrator2').value,
                    presidingArbitrator: document.getElementById('presiding-arbitrator').value,
                    suitValue: document.getElementById('suit-value').value,
                    sittings: document.getElementById('sittings').value,
                    totalCost: document.getElementById('total-cost').value,
                    complianceDays: document.getElementById('compliance-days').value,
                    justifiName: document.getElementById('justifi-name').value,
                    justifiDesignation: document.getElementById('justifi-designation').value,
                    justifiDate: document.getElementById('justifi-date').value,
                    justifiSignature: justifiSignature
                };
                
                // Generate agreement
                generateAgreement(formData);
                
                // Show output section, hide form section
                document.getElementById('form-section').classList.add('hidden');
                document.getElementById('output-section').classList.remove('hidden');
            });
            
            // Back to form button
            document.getElementById('back-to-form').addEventListener('click', function() {
                document.getElementById('output-section').classList.add('hidden');
                document.getElementById('form-section').classList.remove('hidden');
            });
            
            // Download PDF button
            document.getElementById('download-pdf').addEventListener('click', function() {
                const element = document.getElementById('agreement-output');
                const opt = {
                    margin: 10,
                    filename: 'arbitration-agreement.pdf',
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2 },
                    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                };
                
                html2pdf().set(opt).from(element).save();
            });
        });

        // Function to add a plaintiff
        function addPlaintiff() {
            const plaintiffId = `plaintiff-${nextPlaintiffId++}`;
            const plaintiff = { 
                id: plaintiffId, 
                name: '', 
                address: '', 
                contact: '',
                signature: null,
                signatureDate: new Date().toISOString().split('T')[0]
            };
            plaintiffs.push(plaintiff);
            
            // Create plaintiff card
            const plaintiffCard = document.createElement('div');
            plaintiffCard.className = 'party-card';
            plaintiffCard.innerHTML = `
                <button type="button" class="remove-party bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs" data-id="${plaintiffId}" data-type="plaintiff">×</button>
                <h4 class="font-medium mb-2">Plaintiff ${plaintiffs.length}</h4>
                <div class="space-y-2">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                        <input type="text" class="party-name w-full border border-gray-300 rounded-md px-3 py-2" data-id="${plaintiffId}" data-type="plaintiff" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Address</label>
                        <textarea class="party-address w-full border border-gray-300 rounded-md px-3 py-2" rows="2" data-id="${plaintiffId}" data-type="plaintiff" required></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Contact</label>
                        <input type="text" class="party-contact w-full border border-gray-300 rounded-md px-3 py-2" data-id="${plaintiffId}" data-type="plaintiff" required>
                    </div>
                </div>
                <div class="signature-field">
                    <h5 class="font-medium mb-2">Signature</h5>
                    <div class="signature-container mb-3" data-id="${plaintiffId}" data-type="plaintiff">
                        <input type="file" class="signature-upload hidden" data-id="${plaintiffId}" data-type="plaintiff" accept="image/*">
                        <div class="signature-preview w-full h-full flex items-center justify-center" data-id="${plaintiffId}" data-type="plaintiff">
                            <span class="text-gray-500">Click to upload signature</span>
                        </div>
                    </div>
                    <div class="flex justify-between">
                        <button type="button" class="clear-signature bg-red-500 text-white px-3 py-1 rounded text-sm" data-id="${plaintiffId}" data-type="plaintiff">Clear</button>
                        <div class="text-sm text-gray-500">Upload signature image (PNG, JPG)</div>
                    </div>
                    <div class="mt-3">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                        <input type="date" class="signature-date w-full border border-gray-300 rounded-md px-3 py-2" data-id="${plaintiffId}" data-type="plaintiff" required>
                    </div>
                </div>
            `;
            
            document.getElementById('plaintiffs-container').appendChild(plaintiffCard);
            
            // Set default date to today
            plaintiffCard.querySelector('.signature-date').value = plaintiff.signatureDate;
            
            // Add event listeners
            setupPartyEventListeners(plaintiffCard, plaintiffId, 'plaintiff');
        }

        // Function to add a defendant
        function addDefendant() {
            const defendantId = `defendant-${nextDefendantId++}`;
            const defendant = { 
                id: defendantId, 
                name: '', 
                address: '', 
                contact: '',
                signature: null,
                signatureDate: new Date().toISOString().split('T')[0]
            };
            defendants.push(defendant);
            
            // Create defendant card
            const defendantCard = document.createElement('div');
            defendantCard.className = 'party-card';
            defendantCard.innerHTML = `
                <button type="button" class="remove-party bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs" data-id="${defendantId}" data-type="defendant">×</button>
                <h4 class="font-medium mb-2">Defendant ${defendants.length}</h4>
                <div class="space-y-2">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                        <input type="text" class="party-name w-full border border-gray-300 rounded-md px-3 py-2" data-id="${defendantId}" data-type="defendant" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Address</label>
                        <textarea class="party-address w-full border border-gray-300 rounded-md px-3 py-2" rows="2" data-id="${defendantId}" data-type="defendant" required></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Contact</label>
                        <input type="text" class="party-contact w-full border border-gray-300 rounded-md px-3 py-2" data-id="${defendantId}" data-type="defendant" required>
                    </div>
                </div>
                <div class="signature-field">
                    <h5 class="font-medium mb-2">Signature</h5>
                    <div class="signature-container mb-3" data-id="${defendantId}" data-type="defendant">
                        <input type="file" class="signature-upload hidden" data-id="${defendantId}" data-type="defendant" accept="image/*">
                        <div class="signature-preview w-full h-full flex items-center justify-center" data-id="${defendantId}" data-type="defendant">
                            <span class="text-gray-500">Click to upload signature</span>
                        </div>
                    </div>
                    <div class="flex justify-between">
                        <button type="button" class="clear-signature bg-red-500 text-white px-3 py-1 rounded text-sm" data-id="${defendantId}" data-type="defendant">Clear</button>
                        <div class="text-sm text-gray-500">Upload signature image (PNG, JPG)</div>
                    </div>
                    <div class="mt-3">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                        <input type="date" class="signature-date w-full border border-gray-300 rounded-md px-3 py-2" data-id="${defendantId}" data-type="defendant" required>
                    </div>
                </div>
            `;
            
            document.getElementById('defendants-container').appendChild(defendantCard);
            
            // Set default date to today
            defendantCard.querySelector('.signature-date').value = defendant.signatureDate;
            
            // Add event listeners
            setupPartyEventListeners(defendantCard, defendantId, 'defendant');
        }

        // Function to setup event listeners for a party card
        function setupPartyEventListeners(card, partyId, type) {
            // Remove party button
            card.querySelector('.remove-party').addEventListener('click', function() {
                removeParty(partyId, type);
            });
            
            // Name input
            card.querySelector('.party-name').addEventListener('input', function() {
                updateParty(partyId, type, 'name', this.value);
            });
            
            // Address input
            card.querySelector('.party-address').addEventListener('input', function() {
                updateParty(partyId, type, 'address', this.value);
            });
            
            // Contact input
            card.querySelector('.party-contact').addEventListener('input', function() {
                updateParty(partyId, type, 'contact', this.value);
            });
            
            // Signature upload
            const signatureContainer = card.querySelector('.signature-container');
            const signatureUpload = card.querySelector('.signature-upload');
            const signaturePreview = card.querySelector('.signature-preview');
            const clearSignature = card.querySelector('.clear-signature');
            const signatureDate = card.querySelector('.signature-date');
            
            signatureContainer.addEventListener('click', function() {
                signatureUpload.click();
            });
            
            signatureUpload.addEventListener('change', function(e) {
                if (e.target.files && e.target.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        updateParty(partyId, type, 'signature', event.target.result);
                        signaturePreview.innerHTML = `<img src="${event.target.result}" class="signature-preview" alt="Signature">`;
                    };
                    reader.readAsDataURL(e.target.files[0]);
                }
            });
            
            clearSignature.addEventListener('click', function() {
                updateParty(partyId, type, 'signature', null);
                signaturePreview.innerHTML = '<span class="text-gray-500">Click to upload signature</span>';
                signatureUpload.value = '';
            });
            
            signatureDate.addEventListener('change', function() {
                updateParty(partyId, type, 'signatureDate', this.value);
            });
        }

        // Function to update party data
        function updateParty(id, type, field, value) {
            let partyArray = type === 'plaintiff' ? plaintiffs : defendants;
            const party = partyArray.find(p => p.id === id);
            if (party) {
                party[field] = value;
            }
        }

        // Function to remove a party
        function removeParty(id, type) {
            if (type === 'plaintiff') {
                plaintiffs = plaintiffs.filter(p => p.id !== id);
                
                // Remove from UI
                const plaintiffCard = document.querySelector(`.party-name[data-id="${id}"]`).closest('.party-card');
                plaintiffCard.remove();
                
                // Renumber remaining plaintiffs
                document.querySelectorAll('#plaintiffs-container .party-card').forEach((card, index) => {
                    card.querySelector('h4').textContent = `Plaintiff ${index + 1}`;
                });
            } else {
                defendants = defendants.filter(d => d.id !== id);
                
                // Remove from UI
                const defendantCard = document.querySelector(`.party-name[data-id="${id}"]`).closest('.party-card');
                defendantCard.remove();
                
                // Renumber remaining defendants
                document.querySelectorAll('#defendants-container .party-card').forEach((card, index) => {
                    card.querySelector('h4').textContent = `Defendant ${index + 1}`;
                });
            }
        }

        // Function to generate the agreement HTML
        function generateAgreement(data) {
            const outputDiv = document.getElementById('agreement-output');
            
            // Format dates for display
            const agreementDateDisplay = formatDateForDisplay(data.agreementDate);
            const justifiDateDisplay = formatDateForDisplay(data.justifiDate);
            
            // Create plaintiffs list HTML
            let plaintiffsHTML = '';
            data.plaintiffs.forEach((plaintiff, index) => {
                const signatureDate = formatDateForDisplay(plaintiff.signatureDate);
                plaintiffsHTML += `
                    <div class="mb-4">
                        <p><strong>Name:</strong> ${plaintiff.name}</p>
                        <p><strong>Address:</strong> ${plaintiff.address}</p>
                        <p><strong>Contact:</strong> ${plaintiff.contact}</p>
                        ${index < data.plaintiffs.length - 1 ? '<hr class="my-4">' : ''}
                    </div>
                `;
            });
            
            // Create defendants list HTML
            let defendantsHTML = '';
            data.defendants.forEach((defendant, index) => {
                const signatureDate = formatDateForDisplay(defendant.signatureDate);
                defendantsHTML += `
                    <div class="mb-4">
                        <p><strong>Name:</strong> ${defendant.name}</p>
                        <p><strong>Address:</strong> ${defendant.address}</p>
                        <p><strong>Contact:</strong> ${defendant.contact}</p>
                        ${index < data.defendants.length - 1 ? '<hr class="my-4">' : ''}
                    </div>
                `;
            });
            
            // Create signature slots for plaintiffs
            let plaintiffSignaturesHTML = '';
            data.plaintiffs.forEach((plaintiff, index) => {
                const signatureDate = formatDateForDisplay(plaintiff.signatureDate);
                plaintiffSignaturesHTML += `
                    <div class="mb-4 text-center">
                        <p class="font-medium">${plaintiff.name}</p>
                        <div class="signature-slot">
                            ${plaintiff.signature ? `<img src="${plaintiff.signature}" class="signature-preview h-12" alt="${plaintiff.name} Signature">` : ''}
                        </div>
                        <p class="mt-1">Date: ${signatureDate}</p>
                    </div>
                `;
            });
            
            // Create signature slots for defendants
            let defendantSignaturesHTML = '';
            data.defendants.forEach((defendant, index) => {
                const signatureDate = formatDateForDisplay(defendant.signatureDate);
                defendantSignaturesHTML += `
                    <div class="mb-4 text-center">
                        <p class="font-medium">${defendant.name}</p>
                        <div class="signature-slot">
                            ${defendant.signature ? `<img src="${defendant.signature}" class="signature-preview h-12" alt="${defendant.name} Signature">` : ''}
                        </div>
                        <p class="mt-1">Date: ${signatureDate}</p>
                    </div>
                `;
            });
            
            // Create agreement HTML
            outputDiv.innerHTML = `
                <div class="text-center mb-8">
                    <h1 class="text-2xl font-bold mb-2">⚖️ ARBITRATION AGREEMENT</h1>
                    <p class="text-lg"><strong>Date:</strong> ${agreementDateDisplay}</p>
                </div>
                
                <div class="mb-8">
                    <h2 class="text-xl font-bold mb-4">THIS ARBITRATION AGREEMENT</h2>
                    <p class="mb-4">(Hereinafter referred to as the "Agreement") is made and entered into by and between:</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div class="border border-gray-300 p-4 rounded">
                            <h3 class="font-bold mb-2 text-blue-600">Party 1 – Claimant(s)/Plaintiff(s)</h3>
                            ${plaintiffsHTML}
                            <p class="mt-4">(Hereinafter referred to as the <strong>First Party</strong>)</p>
                        </div>
                        
                        <div class="border border-gray-300 p-4 rounded">
                            <h3 class="font-bold mb-2 text-red-600">Party 2 – Respondent(s)/Defendant(s)</h3>
                            ${defendantsHTML}
                            <p class="mt-4">(Hereinafter referred to as the <strong>Second Party</strong>)</p>
                        </div>
                    </div>
                    
                    <p>Collectively referred to as the <strong>Parties</strong>, and individually as a <strong>Party</strong>.</p>
                </div>
                
                <div class="mb-8">
                    <h2 class="text-xl font-bold mb-4">WHEREAS:</h2>
                    <ol class="list-decimal pl-5 space-y-2">
                        <li>The Parties are involved in a legal dispute arising out of ${data.disputeNature} ("Dispute");</li>
                        <li>The Parties have mutually agreed to refer the said Dispute to <strong>arbitration</strong>, to be conducted through the <strong>JustiFi – Online Legal Aid & Arbitration Platform</strong>, under its established rules and procedures;</li>
                        <li>The Parties desire to record their mutual understanding and agreement to the terms, conditions, and procedures governing such arbitration.</li>
                    </ol>
                </div>
                
                <div class="mb-8">
                    <h2 class="text-xl font-bold mb-4">1. Arbitration Reference</h2>
                    <p>1.1 The Parties voluntarily and irrevocably agree to submit the Dispute to arbitration in accordance with the provisions of the <strong>Arbitration Act, 2001 (Bangladesh)</strong>.</p>
                    <p>1.2 The arbitration proceedings shall be conducted primarily through <strong>Online Dispute Resolution (ODR)</strong> using the <strong>JustiFi Platform</strong>.</p>
                    <p>1.3 In exceptional cases, where physical/offline hearings are deemed necessary, the <strong>Arbitrator(s)</strong> may order the same. All associated costs shall be borne <strong>equally (50%-50%)</strong> by both Parties.</p>
                </div>
                
                <div class="mb-8">
                    <h2 class="text-xl font-bold mb-4">2. Constitution of the Arbitral Tribunal</h2>
                    <p>2.1 <strong>Number of Arbitrators:</strong> Three (3)</p>
                    <ul class="list-disc pl-5 mt-2">
                        <li><strong>Arbitrator 1:</strong> ${data.arbitrator1}</li>
                        <li><strong>Arbitrator 2:</strong> ${data.arbitrator2}</li>
                        <li><strong>Arbitrator 3 (Presiding Arbitrator):</strong> ${data.presidingArbitrator}</li>
                    </ul>
                    <p class="mt-2">2.2 The Arbitrators shall be <strong>neutral and independent</strong>, in accordance with <strong>Section 12 of the Arbitration Act, 2001</strong>, and their decision shall be <strong>final and binding</strong> upon the Parties.</p>
                </div>
                
                <div class="mb-8">
                    <h2 class="text-xl font-bold mb-4">3. Seat, Venue & Language</h2>
                    <p>3.1 <strong>Seat of Arbitration:</strong> Dhaka, Bangladesh (unless otherwise mutually agreed).</p>
                    <p>3.2 <strong>Mode:</strong> Online (virtual hearings) via the <strong>JustiFi ODR System</strong>.</p>
                    <p>3.3 <strong>Language:</strong> English and/or Bangla, as agreed between the Parties.</p>
                </div>
                
                <div class="mb-8">
                    <h2 class="text-xl font-bold mb-4">4. Suit Value, Costs & Fees</h2>
                    <p>4.1 <strong>Suit Value (Dispute Amount):</strong> BDT ${data.suitValue}</p>
                    <p>4.2 <strong>Number of Sittings (Initially Agreed):</strong> ${data.sittings}</p>
                    <p>4.3 <strong>Total Arbitration Cost (Administrative + Arbitrator Fees):</strong> BDT ${data.totalCost}</p>
                    <p>4.4 All costs of arbitration shall be shared <strong>equally</strong> between the Parties.</p>
                    <p>4.5 If additional sittings are deemed necessary for fair adjudication, the Arbitrator(s) may extend proceedings, and any additional costs shall also be borne equally by both Parties.</p>
                    <p>4.6 Each Party shall individually bear the cost of its own <strong>lawyers, representatives, advisors, or personal expenses</strong>.</p>
                </div>
                
                <div class="mb-8">
                    <h2 class="text-xl font-bold mb-4">5. Premature Termination / Withdrawal</h2>
                    <p>5.1 Should either Party withdraw or terminate participation before conclusion:</p>
                    <ul class="list-disc pl-5 mt-2">
                        <li>That Party must pay all costs incurred up to the date of termination; and</li>
                        <li>An additional <strong>lump-sum penalty</strong> as determined by the Arbitrator(s) or JustiFi to cover administrative expenses.</li>
                    </ul>
                    <p class="mt-2">5.2 The arbitration may continue <strong>ex parte</strong> if one Party fails to participate, at the discretion of the Arbitrator(s).</p>
                </div>
                
                <div class="mb-8">
                    <h2 class="text-xl font-bold mb-4">6. Conduct & Confidentiality</h2>
                    <p>6.1 Both Parties shall maintain professional conduct and respect toward the Arbitrator(s) and the <strong>JustiFi platform</strong>.</p>
                    <p>6.2 Any form of abuse, misconduct, or defamatory act towards the Tribunal or platform shall constitute a <strong>breach of this Agreement</strong>.</p>
                    <p>6.3 All proceedings, documents, evidence, and awards shall remain <strong>strictly confidential</strong>.</p>
                    <p>6.4 No Party shall disclose or publish any part of the arbitration process unless required by law or upon written consent of the other Party.</p>
                </div>
                
                <div class="mb-8">
                    <h2 class="text-xl font-bold mb-4">7. Powers & Duties of Arbitrators</h2>
                    <p>The Arbitrator(s) shall have the power to:</p>
                    <ul class="list-disc pl-5 mt-2">
                        <li>Decide all procedural and evidentiary matters;</li>
                        <li>Request additional hearings, documents, or witnesses;</li>
                        <li>Extend the number of sittings as necessary;</li>
                        <li>Prohibit any unilateral or ex parte communications;</li>
                        <li>Interpret contractual obligations to reach a fair and lawful resolution.</li>
                    </ul>
                </div>
                
                <div class="mb-8">
                    <h2 class="text-xl font-bold mb-4">8. Applicable Law & Jurisdiction</h2>
                    <p>This Agreement and all arbitration proceedings shall be governed by:</p>
                    <ul class="list-disc pl-5 mt-2">
                        <li>The <strong>Arbitration Act, 2001 (Bangladesh)</strong>; and</li>
                        <li>The <strong>laws of the People's Republic of Bangladesh</strong>.</li>
                    </ul>
                    <p class="mt-2">Courts situated in <strong>Dhaka, Bangladesh</strong> shall have <strong>exclusive jurisdiction</strong> for enforcement, setting aside, or any judicial assistance concerning the arbitral award.</p>
                </div>
                
                <div class="mb-8">
                    <h2 class="text-xl font-bold mb-4">9. Binding Nature of Award</h2>
                    <p>The Award rendered by the Arbitral Tribunal shall be:</p>
                    <ul class="list-disc pl-5 mt-2">
                        <li><strong>Final and binding</strong> upon both Parties, under <strong>Section 44 of the Arbitration Act, 2001</strong>;</li>
                        <li><strong>Enforceable as a decree or court order</strong> within Bangladesh; and</li>
                        <li>Obligatory to be complied with within <strong>${data.complianceDays} days</strong> from the date of issuance.</li>
                    </ul>
                </div>
                
                <div class="mb-8">
                    <h2 class="text-xl font-bold mb-4">10. Execution & Signatures</h2>
                    <p class="mb-4"><strong>IN WITNESS WHEREOF</strong>, the Parties have executed this Arbitration Agreement on the date first written above.</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
                        <div class="text-center border-t border-gray-300 pt-4">
                            <p class="font-bold">Party 1 (First Party)</p>
                            <p class="mt-4">Plaintiffs/Claimants</p>
                            <div class="mt-4">
                                ${plaintiffSignaturesHTML}
                            </div>
                        </div>
                        
                        <div class="text-center border-t border-gray-300 pt-4">
                            <p class="font-bold">Party 2 (Second Party)</p>
                            <p class="mt-4">Defendants/Respondents</p>
                            <div class="mt-4">
                                ${defendantSignaturesHTML}
                            </div>
                        </div>
                        
                        <div class="text-center border-t border-gray-300 pt-4">
                            <p class="font-bold">On behalf of JustiFi (Witness & Record Keeper)</p>
                            <p class="mt-4">Name: ${data.justifiName}</p>
                            <p>Designation: ${data.justifiDesignation}</p>
                            <div class="mt-4">
                                <div class="signature-slot">
                                    ${data.justifiSignature ? `<img src="${data.justifiSignature}" class="signature-preview h-12" alt="JustiFi Signature">` : ''}
                                </div>
                                <p class="mt-1">Date: ${justifiDateDisplay}</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-12">
                    <h2 class="text-xl font-bold mb-4">⚖️ Legal References Incorporated</h2>
                    <table class="w-full border border-gray-300">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="border border-gray-300 p-2 text-left">Clause</th>
                                <th class="border border-gray-300 p-2 text-left">Reference</th>
                                <th class="border border-gray-300 p-2 text-left">Purpose</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="border border-gray-300 p-2">1, 2, 8, 9</td>
                                <td class="border border-gray-300 p-2">Arbitration Act, 2001 (Bangladesh)</td>
                                <td class="border border-gray-300 p-2">Legal foundation for arbitration procedure, award, and enforcement</td>
                            </tr>
                            <tr>
                                <td class="border border-gray-300 p-2">2.2</td>
                                <td class="border border-gray-300 p-2">Section 12, Arbitration Act 2001</td>
                                <td class="border border-gray-300 p-2">Independence and neutrality of arbitrators</td>
                            </tr>
                            <tr>
                                <td class="border border-gray-300 p-2">9</td>
                                <td class="border border-gray-300 p-2">Section 44, Arbitration Act 2001</td>
                                <td class="border border-gray-300 p-2">Binding nature and enforcement of award</td>
                            </tr>
                            <tr>
                                <td class="border border-gray-300 p-2">8</td>
                                <td class="border border-gray-300 p-2">Civil Procedure Code (CPC), Bangladesh</td>
                                <td class="border border-gray-300 p-2">Court jurisdiction for award enforcement</td>
                            </tr>
                            <tr>
                                <td class="border border-gray-300 p-2">General</td>
                                <td class="border border-gray-300 p-2">JustiFi ODR Rules</td>
                                <td class="border border-gray-300 p-2">Platform's procedural framework</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `;
        }
        
        // Helper function to format date for display
        function formatDateForDisplay(dateString) {
            if (!dateString) return '';
            
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return '';
            
            const day = date.getDate();
            const month = date.toLocaleString('default', { month: 'long' });
            const year = date.getFullYear();
            
            return `${day} ${month}, ${year}`;
        }
    </script>
</body>
</html>